!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("mobx")):"function"==typeof define&&define.amd?define(["mobx"],n):"object"==typeof exports?exports.imagine=n(require("mobx")):e.imagine=n(e.mobx)}(window,(function(e){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/dist/",t(t.s=1)}([function(n,t){n.exports=e},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bindingEngine=n.scopes=n.contexts=n.bind=void 0;var r=new(t(3).Imagine),i=t(0);Object.defineProperty(n,"observable",{enumerable:!0,get:function(){return i.observable}}),Object.defineProperty(n,"computed",{enumerable:!0,get:function(){return i.computed}}),n.bind=r.bind,n.contexts=r.bindingEngine.boundElements,n.scopes=r.bindingEngine.scopes,n.bindingEngine=r.bindingEngine},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BindingContext=void 0;var r=function(){this.propertyName="",this.preventCircularUpdate=!1};n.BindingContext=r},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Imagine=void 0;var r=t(4),i=t(2),o=function(){function e(){var e=this;this.bind=function(n,t,r){if(r&&(window.__debug_imagine=e),"#document-fragment"===(n=n||document.getElementsByTagName("body")[0]).nodeName)for(var o=0;o<n.childNodes.length;o++){var a=new Map,d=new i.BindingContext;d.vm=t,a.set("template",d),e.bindingEngine.boundElements.set(n.childNodes[o],a)}e.recursiveBindNodes(n,t)},this.bindingEngine=new r.BindingEngine}return e.prototype.recursiveBindNodes=function(e,n){for(var t=[],r=0;r<e.childNodes.length;r++)t.push(e.childNodes[r]);if(1===e.nodeType&&this.bindAttributes(e,n),3===e.nodeType&&this.bindInlinedText(e,n),e.childNodes.length>0)for(r=0;r<e.childNodes.length;r++)t.indexOf(e.childNodes[r])>-1&&this.recursiveBindNodes(e.childNodes[r],n)},e.prototype.bindAttributes=function(e,n){for(var t=[],r=e.attributes.length-1;r>=0;r--){(a=this.bindingEngine.parseBinding(e.attributes[r].name,e.attributes[r].value,e,n))&&(t.push(a),e.removeAttribute(e.attributes[r].name))}for(var i=0,o=t;i<o.length;i++){var a=o[i];this.bindingEngine.bindInitPhase(a,n)}for(var d=0,l=t;d<l.length;d++){a=l[d];this.bindingEngine.bindUpdatePhase(a,n)}},e.prototype.bindInlinedText=function(e,n){var t=/\${[a-zA-Z.']*}/gm;if(t.test(e.textContent)){for(var r=e.textContent.split(t),i=e.textContent.match(t),o=[],a=0;a<r.length;a++){o.push(document.createTextNode(r[a]));var d=document.createElement("span");if(i[a]){var l=this.bindingEngine.parseBinding("@text",i[a].substring(2,i[a].length-1),d,n);l&&(l.element=d,this.bindingEngine.bindInitPhase(l,n),this.bindingEngine.bindUpdatePhase(l,n)),o.push(d)}}e.replaceWith.apply(e,o)}},e}();n.Imagine=o},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BindingEngine=void 0;var r=t(0),i=t(5),o=t(2),a=t(6),d=function(){function e(){var n=this;this.parseBinding=function(t,i,o,a){var d={handler:"",parameter:"",propertyName:i,bindingValue:null,element:o};switch(t[0]){case"@":if(!e.handlers[t.substr(1)])throw"Unknown binding '"+t.substr(1)+"'";d.handler=t.substr(1);break;case":":d.handler="__property",d.parameter=t.substr(1);break;case"_":d.handler="__attribute",d.parameter=t.substr(1);break;case"#":d.handler="__event",d.parameter=t.substr(1);break;default:return null}var l=/(\w+)\s*\?\s*\'([\w\s:\-!+=]+)'\s*:\s*'([\w\s:\-!+=]+)'/gm;if(i.match(/^[\w.]+$/gm)){var u=n.resolveScopeAndCreateDependencyTree(a,i,t,i,o)||{},s=u.propertyName,p=u.scope;if(void 0!==s)"this"===s?d.bindingValue=p:p instanceof Object&&s in p&&(r.isObservableArray(p[s])?d.bindingValue=p[s]:r.isObservableProp(p,s)?d.bindingValue=r.getAtom(p,s):(p[s],d.bindingValue=p[s]));else{if(!(i.indexOf(".")<0))return null;d.bindingValue=i}}else if(i.match(l)){var c=l.exec(i),f=c[1],b=n.resolveScopeAndCreateDependencyTree(a,f,t,i,o)||{},v=b.propertyName,h=b.scope;if(void 0===v)return null;if(!(v in h))return null;var m=r.computed((function(){return h[v]?c[2]:c[3]}));d.propertyName=v,d.bindingValue=m}else if("!"==i[0]){var g=n.resolveScopeAndCreateDependencyTree(a,i.substr(1),t,i,o)||{},y=g.propertyName,N=g.scope;if(void 0===y)return null;m=r.computed((function(){return!N[y]}));d.propertyName=y,d.bindingValue=m}else if(i.indexOf("+")>0){var x=i.split("+");x=x.map((function(e){return e.trim()}));for(var w=/^'([\w#/]+)'$/gm,E=!0,H=0;H<x.length;H++){if(!x[H].match(w))if(void 0===(s=(n.resolveScopeAndCreateDependencyTree(a,x[H],t,i,o)||{}).propertyName)){E=!1;continue}}if(!E)return null;m=r.computed((function(){for(var e="",r=0;r<x.length;r++)if(x[r].match(w))e+=w.exec(x[r])[1];else{var d=n.resolveScopeAndCreateDependencyTree(a,x[r],t,i,o),l=d.propertyName,u=d.scope;l in u&&(e+=u[l])}return e}));d.propertyName=i.substr(1),d.bindingValue=m}return d},this.bindInitPhase=function(t,i,a){var d;void 0===a&&(a=!1);var l,u,s=e.handlers[t.handler];n.boundElements.has(t.element)?l=n.boundElements.get(t.element):(l=new Map,n.boundElements.set(t.element,l));var p=t.handler+(t.parameter?":"+t.parameter:"");l.has(p)&&!a||((u=new o.BindingContext).vm=i,u.propertyName=t.propertyName,u.parameter=t.parameter,l.set(p,u),null===(d=s.init)||void 0===d||d.call(n,t.element,n.unwrap(t.bindingValue),u,(function(e){"this"!==t.propertyName&&(u.preventCircularUpdate=!0,r.isObservable(t.bindingValue)?t.bindingValue.set(e):t.bindingValue=e)})))},this.bindUpdatePhase=function(t,i){var o=e.handlers[t.handler],a=n.boundElements.get(t.element),d=t.handler+(t.parameter?":"+t.parameter:""),l=a.get(d);if(o.update){var u=function(e){var r=n.unwrap(t.bindingValue);l.preventCircularUpdate||o.update(t.element,r,l,e),l.preventCircularUpdate=!1};r.isObservable(t.bindingValue)&&(r.isObservableArray(t.bindingValue)&&r.observe(l.vm,t.propertyName,(function(e){u(e),r.observe(l.vm[t.propertyName],u)})),r.observe(t.bindingValue,u)),u()}},this.boundElements=new WeakMap,this.scopes=new Map}return e.prototype.resolveScopeAndCreateDependencyTree=function(e,n,t,i,o){var a=this,d=[],l=this.recursiveResolveScope(e,n,d);if(d.length>0)for(var u=[],s=0,p=d;s<p.length;s++){var c=p[s],f=r.observe(c.vm,c.property,(function(){for(var n=0,r=u;n<r.length;n++){(0,r[n])()}a.rebind(t,i,e,o)}));u.push(f)}return l},e.prototype.recursiveResolveScope=function(e,n,t){var r=n.split("."),i=e;switch(r.length){case 1:return"this"===r[0]||r[0]in e?{propertyName:r[0],scope:i}:null;case 2:if(this.scopes.has(r[0]))i=this.scopes.get(r[0]);else{if(!(r[0]in e))throw"Undefined scope: "+r[0];t.push({vm:e,property:r[0]}),i=e[r[0]]}return i&&r[1]in i?{propertyName:r[1],scope:i}:null;default:if(this.scopes.has(r[0]))i=this.scopes.get(r[0]);else{if(!(r[0]in e))throw"Undefined scope: "+r[0];t.push({vm:e,property:r[0]}),i=e[r[0]]}return this.recursiveResolveScope(i,r.slice(1).join("."),t)}},e.prototype.rebind=function(e,n,t,r){var i=this.parseBinding(e,n,r,t);if(i){if(this.boundElements.has(r)){var o=this.boundElements.get(r),a=i.handler+(i.parameter?":"+i.parameter:"");o.has(a)&&(console.log("EXISTING CONTEXT FOUND",o.get(a)),o.delete(a))}this.bindInitPhase(i,t,!0),this.bindUpdatePhase(i,t)}},e.prototype.unwrap=function(e){return r.isObservableArray(e)||!r.isObservable(e)?e:e.get()},e.handlers={},e}();n.BindingEngine=d,d.handlers.text=new i.TextHandler,d.handlers.value=new i.ValueHandler,d.handlers.foreach=new i.ForEachHandler,d.handlers.context=new i.ContextHandler,d.handlers.if=new i.IfHandler,d.handlers.scope=new i.ScopeHandler,d.handlers.html=new i.HtmlHandler,d.handlers.visible=new i.VisibleHandler,d.handlers.__attribute=new i.AttributeHandler,d.handlers.__property=new a.PropertyHandler,d.handlers.__event=new i.EventHandler},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ForEachHandler=n.HtmlHandler=n.ContextHandler=n.IfHandler=n.ScopeHandler=n.AttributeHandler=n.EventHandler=n.ValueHandler=n.VisibleHandler=n.TextHandler=n.BindingHandler=void 0;var r=t(1),i=t(0),o=function(){};n.BindingHandler=o;var a=function(){function e(){}return e.prototype.update=function(e,n){e.innerText=n},e}();n.TextHandler=a;var d=function(){var e=this;this.init=function(n){e.initialValue=getComputedStyle(n).display},this.update=function(n,t){n.style.display=t?e.initialValue:"none"}};n.VisibleHandler=d;var l=function(){function e(){}return e.prototype.init=function(e,n,t,r){e.addEventListener("input",(function(){r(e.value)}))},e.prototype.update=function(e,n){e.value=n},e}();n.ValueHandler=l;var u=function(){function e(){}return e.prototype.init=function(e,n,t){"function"==typeof n&&e.addEventListener(t.parameter,(function(e){n(t.vm,e)}))},e}();n.EventHandler=u;var s=function(){function e(){}return e.prototype.update=function(e,n,t){e.setAttribute(t.parameter,n)},e}();n.AttributeHandler=s;var p=function(){function e(){}return e.prototype.init=function(e,n,t,i){r.scopes.set(n,t.vm)},e}();n.ScopeHandler=p;var c=function(){function e(){}return e.prototype.init=function(e,n,t,r){for(var i=document.createDocumentFragment();e.childNodes.length>0;)i.appendChild(e.childNodes[0]);t.template=i},e.prototype.update=function(e,n,t,i){if(e.innerText="",n&&t.template){var o=t.template.cloneNode(!0);r.bind(o,t.vm),e.appendChild(o)}},e}();n.IfHandler=c;var f=function(){function e(){}return e.prototype.init=function(e,n,t,r){for(var i=document.createDocumentFragment();e.childNodes.length>0;)i.appendChild(e.childNodes[0]);t.template=i},e.prototype.update=function(e,n,t,i){if(e.innerText="",null!=n&&t.template){var o=t.template.cloneNode(!0);r.bind(o,n),e.appendChild(o)}},e}();n.ContextHandler=f;var b=function(){function e(){}return e.prototype.update=function(e,n,t,i){if(e.innerText="",null!=n){var o=document.createElement("template");o.innerHTML=n,e.appendChild(o.content),setTimeout((function(){for(var n=0;n<e.childNodes.length;n++)r.bind(e.childNodes[n],t.vm)}),0)}},e}();n.HtmlHandler=b;var v=function(){function e(){}return e.prototype.init=function(e,n,t,r){for(var i=document.createDocumentFragment();e.childNodes.length>0;)i.appendChild(e.childNodes[0]);t.template=i},e.prototype.update=function(e,n,t,o){if(o&&"splice"===o.type){for(var a=0,d=o.added;a<d.length;a++){h(s=d[a])}for(var l=0,u=o.removed;l<u.length;l++)for(var s=u[l],p=e.childNodes.length-1;p>=0;p--){if(r.contexts.has(e.childNodes[p])&&r.contexts.get(e.childNodes[p]).has("template"))s===r.contexts.get(e.childNodes[p]).get("template").vm&&e.childNodes[p].remove()}}else if(o&&"update"===o.type){e.innerHTML="";for(var c=0,f=o.newValue;c<f.length;c++){h(s=f[c])}}else for(var b=0,v=n;b<v.length;b++){h(s=v[b])}function h(n){if(t.template){var o=t.template.cloneNode(!0);r.bind(o,n);for(var a=function(t){var a=o.childNodes[t];1===a.nodeType&&setTimeout((function(){if("selecteditem"in e&&"selected"in a){var t={selected:i.observable.box(!1)},o=!1;i.observe(t.selected,(function(t){!0!==t.newValue||o||(o=!0,e.selecteditem=n),o=!1})),e.selecteditem===n&&setTimeout((function(){a.selected=!0}),10),i.observe(e,"selecteditem",(function(e){o||(o=!0,e.newValue===n?a.selected=!0:a.selected=!1),o=!1}));var d={handler:"__property",propertyName:"selected",bindingValue:t.selected,parameter:"selected",element:a};r.bindingEngine.bindInitPhase(d,t),r.bindingEngine.bindUpdatePhase(d,t)}}),0)},d=0;d<o.childNodes.length;d++)a(d);e.appendChild(o)}}},e}();n.ForEachHandler=v},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PropertyHandler=void 0;var r=t(0),i=function(){function e(){}return e.prototype.init=function(e,n,t,i){setTimeout((function(){var n=t.parameter,o=function e(n,t){if(n.hasOwnProperty(t))return Object.getOwnPropertyDescriptor(n,t);var r=Object.getPrototypeOf(n);return r?e(r,t):void 0}(e,n);if(o)Object.defineProperty(e,n,{enumerable:o.enumerable||!1,configurable:o.enumerable||!1,get:o.get,set:function(n){o.set&&o.set.call(e,n),t.preventCircularUpdate||i(n),t.preventCircularUpdate=!1}});else{var a=r.observable.box(),d={};Object.defineProperty(d,n,{enumerable:!0,configurable:!0,get:function(){return a.get()},set:function(e){a.set(e),t.preventCircularUpdate||(t.preventCircularUpdate=!0,i(e)),t.preventCircularUpdate=!1}}),r.extendObservable(e,d)}}),0)},e.prototype.update=function(e,n,t,r){setTimeout((function(){t.preventCircularUpdate=!0,e[t.parameter]=n}),0)},e}();n.PropertyHandler=i}])}));