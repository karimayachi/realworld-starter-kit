!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("mobx")):"function"==typeof define&&define.amd?define(["mobx"],n):"object"==typeof exports?exports.imagine=n(require("mobx")):e.imagine=n(e.mobx)}(window,(function(e){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/dist/",t(t.s=1)}([function(n,t){n.exports=e},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bindingEngine=n.scopes=n.contexts=n.bind=void 0;var r=new(t(2).Imagine),i=t(0);Object.defineProperty(n,"observable",{enumerable:!0,get:function(){return i.observable}}),Object.defineProperty(n,"computed",{enumerable:!0,get:function(){return i.computed}}),Object.defineProperty(n,"observe",{enumerable:!0,get:function(){return i.observe}}),n.bind=r.bind,n.contexts=r.bindingEngine.boundElements,n.scopes=r.bindingEngine.scopes,n.bindingEngine=r.bindingEngine},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Imagine=n.PROPERTY_SETTER_SYMBOL=void 0;var r=t(4),i=t(3);n.PROPERTY_SETTER_SYMBOL=Symbol();var o=function(){function e(){var e=this;this.bind=function(n,t,r){if(r&&(window.__debug_imagine=e),"#document-fragment"===(n=n||document.getElementsByTagName("body")[0]).nodeName)for(var o=0;o<n.childNodes.length;o++){var a=new Map,d=new i.BindingContext;d.vm=t,a.set("template",d),e.bindingEngine.boundElements.set(n.childNodes[o],a)}e.recursiveBindNodes(n,t)},this.bindingEngine=new r.BindingEngine}return e.prototype.recursiveBindNodes=function(e,n){for(var t=[],r=0;r<e.childNodes.length;r++)t.push(e.childNodes[r]);if(1===e.nodeType&&("IMAGINE-TRANSFORM"===e.tagName?this.bindDirectives(e,n):this.bindAttributes(e,n)),3===e.nodeType&&this.bindInlinedText(e,n),e.childNodes.length>0)for(r=0;r<e.childNodes.length;r++)t.indexOf(e.childNodes[r])>-1&&this.recursiveBindNodes(e.childNodes[r],n)},e.prototype.bindAttributes=function(e,n){for(var t=[],r=e.attributes.length-1;r>=0;r--){(a=this.bindingEngine.parseBinding(e.attributes[r].name,e.attributes[r].value,e,n))&&(t.push(a),e.removeAttribute(e.attributes[r].name))}for(var i=0,o=t;i<o.length;i++){var a=o[i];this.bindingEngine.bindInitPhase(a)}for(var d=0,s=t;d<s.length;d++){a=s[d];this.bindingEngine.bindUpdatePhase(a)}},e.prototype.bindDirectives=function(e,n){var t=e.getAttribute("TRANSFORM")||"",r=this.bindingEngine.parseBinding("@transform",t,e,n);r&&(r.parameter=e.getAttribute("TARGET")||"",this.bindingEngine.bindInitPhase(r))},e.prototype.bindInlinedText=function(e,n){var t=/\${[a-zA-Z.\s?:']*}/gm;if(t.test(e.textContent)){for(var r=e.textContent.split(t),i=e.textContent.match(t),o=[],a=0;a<r.length;a++){o.push(document.createTextNode(r[a]));var d=document.createElement("span");if(i[a]){var s=this.bindingEngine.parseBinding("@text",i[a].substring(2,i[a].length-1),d,n);s&&(s.element=d,this.bindingEngine.bindInitPhase(s),this.bindingEngine.bindUpdatePhase(s)),o.push(d)}}e.replaceWith.apply(e,o)}},e}();n.Imagine=o},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BindingContext=void 0;var r=function(){this.propertyName="",this.preventCircularUpdate=!1};n.BindingContext=r},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BindingEngine=void 0;var r=t(0),i=t(5),o=t(3),a=t(6),d=function(){function e(){var n=this;this.parseBinding=function(t,i,o,a){var d={handler:"",parameter:"",propertyName:i,vm:a,scope:null,bindingValue:null,element:o};switch(t[0]){case"@":if(!e.handlers[t.substr(1)])throw"Unknown binding '"+t.substr(1)+"'";d.handler=t.substr(1);break;case":":d.handler="__property",d.parameter=t.substr(1);break;case"_":d.handler="__attribute",d.parameter=t.substr(1);break;case"#":d.handler="__event",d.parameter=t.substr(1);break;default:return null}var s=/^([\w.]+)\s*\?\s*'([\w\s:\-?!+\/#=]+)'\s*:\s*'([\w\s:\-?!+\/#=]+)'\s*$/gm,l=/^([\w.]+)\s*==\s*'([\w\s:\-?!+\/#=]+)'\s*$/gm,u=/^([\w.]+)\s*==\s*([0-9]+)\s*$/gm;if(i.match(/^[\w.]+$/gm)){var p=n.resolveScopeAndCreateDependencyTree(a,i,t,i,o)||{},c=p.propertyName,f=p.scope;if(d.propertyName=c||d.propertyName,d.scope=f,void 0!==c)"this"===c?d.bindingValue=f:f instanceof Object&&c in f&&(r.isObservableArray(f[c])?d.bindingValue=f[c]:r.isObservableProp(f,c)?d.bindingValue=r.getAtom(f,c):(f[c],d.bindingValue=f[c]));else{if(!(i.indexOf(".")<0))return null;d.bindingValue=i,d.scope=a}}else if(i.match(s)){var m=s.exec(i),v=m[1],b=n.resolveScopeAndCreateDependencyTree(a,v,t,i,o)||{},h=b.propertyName,g=b.scope;if(void 0===h)return null;if(!(h in g))return null;var y=r.computed((function(){return g[h]?m[2]:m[3]}));d.propertyName=h,d.bindingValue=y,d.scope=g}else if(i.match(u)||i.match(l)){var E=i.match(l)?l.exec(i):u.exec(i),N=(v=E[1],i.match(l)?E[2]:parseInt(E[2])),T=n.resolveScopeAndCreateDependencyTree(a,v,t,i,o)||{},w=T.propertyName,x=T.scope;if(void 0===w)return null;if(!(w in x))return null;y=r.computed((function(){return x[w]===N}));d.propertyName=w,d.bindingValue=y,d.scope=x}else if("!"==i[0]){var O=n.resolveScopeAndCreateDependencyTree(a,i.substr(1),t,i,o)||{},_=O.propertyName,P=O.scope;if(void 0===_)return null;y=r.computed((function(){return!P[_]}));d.propertyName=_,d.bindingValue=y,d.scope=P}else if(i.indexOf("+")>0){var H=i.split("+");H=H.map((function(e){return e.trim()}));for(var C=/^'([\w#/\s()]+)'$/gm,S=!0,V=0;V<H.length;V++){if(!H[V].match(C))if(void 0===(c=(n.resolveScopeAndCreateDependencyTree(a,H[V],t,i,o)||{}).propertyName)){S=!1;continue}}if(!S)return null;y=r.computed((function(){for(var e="",r=0;r<H.length;r++)if(H[r].match(C))e+=C.exec(H[r])[1];else{var d=n.resolveScopeAndCreateDependencyTree(a,H[r],t,i,o),s=d.propertyName,l=d.scope;s in l&&(e+=l[s])}return e}));d.propertyName=i.substr(1),d.bindingValue=y}return"__event"==d.handler&&(d.scope=a),d},this.bindInitPhase=function(t,i){var a;void 0===i&&(i=!1);var d,s,l=e.handlers[t.handler];n.boundElements.has(t.element)?d=n.boundElements.get(t.element):(d=new Map,n.boundElements.set(t.element,d));var u=t.handler+(t.parameter?":"+t.parameter:"");d.has(u)&&!i||((s=new o.BindingContext).vm=t.scope,s.originalVm=t.vm,s.propertyName=t.propertyName,s.parameter=t.parameter,d.set(u,s),null===(a=l.init)||void 0===a||a.call(n,t.element,n.unwrap(t.bindingValue),s,(function(e){"this"!==t.propertyName&&(s.preventCircularUpdate=!0,r.isObservableArray(t.bindingValue)?t.scope[t.propertyName]=e:r.isObservable(t.bindingValue)?t.bindingValue.set(e):t.bindingValue=e)})))},this.bindUpdatePhase=function(t){var i=e.handlers[t.handler],o=n.boundElements.get(t.element),a=t.handler+(t.parameter?":"+t.parameter:""),d=o.get(a);if(i.update){var s=function(e){var r=n.unwrap(t.bindingValue);d.preventCircularUpdate||i.update(t.element,r,d,e),d.preventCircularUpdate=!1};r.isObservable(t.bindingValue)&&(r.isObservableArray(t.bindingValue)&&r.observe(d.vm,t.propertyName,(function(e){t.bindingValue=e.newValue,r.observe(t.bindingValue,s),s(e)})),r.observe(t.bindingValue,s)),s()}},this.getTransformFor=function(e,t){var r="transform:"+t;return n.boundElements.has(e)&&n.boundElements.get(e).has(r)?n.boundElements.get(e).get(r).vm[n.boundElements.get(e).get(r).propertyName]:null===e.parentElement?null:n.getTransformFor(e.parentElement,t)},this.boundElements=new WeakMap,this.scopes=new Map}return e.prototype.resolveScopeAndCreateDependencyTree=function(e,n,t,i,o){var a=this,d=[],s=this.recursiveResolveScope(e,n,d);if(d.length>0){var l=[],u=document.createDocumentFragment();if(null==s)for(;o.childNodes.length>0;)u.appendChild(o.childNodes[0]);for(var p=0,c=d;p<c.length;p++){var f=c[p],m=r.observe(f.vm,f.property,(function(){for(var n=0,r=l;n<r.length;n++){(0,r[n])()}for(;u.childNodes.length>0;)o.appendChild(u.childNodes[0]);a.rebind(t,i,e,o)}));l.push(m)}}return s},e.prototype.recursiveResolveScope=function(e,n,t){var r=n.split("."),i=e;switch(r.length){case 1:return"this"===r[0]||r[0]in e?{propertyName:r[0],scope:i}:null;case 2:if(this.scopes.has(r[0]))i=this.scopes.get(r[0]);else{if(!(r[0]in e))throw"Undefined scope: "+r[0];t.push({vm:e,property:r[0]}),i=e[r[0]]}return i&&r[1]in i?{propertyName:r[1],scope:i}:null;default:if(this.scopes.has(r[0]))i=this.scopes.get(r[0]);else{if(!(r[0]in e))throw"Undefined scope: "+r[0];t.push({vm:e,property:r[0]}),i=e[r[0]]}return this.recursiveResolveScope(i,r.slice(1).join("."),t)}},e.prototype.rebind=function(e,n,t,r){var i,o,a=this.parseBinding(e,n,r,t);if(a){if(this.boundElements.has(r)){var d=this.boundElements.get(r),s=a.handler+(a.parameter?":"+a.parameter:"");d.has(s)&&(o=null===(i=d.get(s))||void 0===i?void 0:i.template,d.delete(s))}if(this.bindInitPhase(a,!0),this.boundElements.has(r)&&void 0!==o){d=this.boundElements.get(r),s=a.handler+(a.parameter?":"+a.parameter:"");d.has(s)&&(d.get(s).template=o)}this.bindUpdatePhase(a)}},e.prototype.unwrap=function(e){return r.isObservableArray(e)||!r.isObservable(e)?e:e.get()},e.handlers={},e}();n.BindingEngine=d,d.handlers.text=new i.TextHandler,d.handlers.value=new i.ValueHandler,d.handlers.foreach=new i.ForEachHandler,d.handlers.context=new i.ContextHandler,d.handlers.if=new i.IfHandler,d.handlers.scope=new i.ScopeHandler,d.handlers.html=new i.HtmlHandler,d.handlers.visible=new i.VisibleHandler,d.handlers.transform=new i.TransformHandler,d.handlers.__attribute=new i.AttributeHandler,d.handlers.__property=new a.PropertyHandler,d.handlers.__event=new i.EventHandler},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ForEachHandler=n.HtmlHandler=n.ContextHandler=n.IfHandler=n.TransformHandler=n.ScopeHandler=n.AttributeHandler=n.EventHandler=n.ValueHandler=n.VisibleHandler=n.TextHandler=n.BindingHandler=void 0;var r=t(1),i=t(0),o=function(){};n.BindingHandler=o;var a=function(){function e(){}return e.prototype.update=function(e,n){var t=r.bindingEngine.getTransformFor(e,"text");e.textContent=t?t(n):n},e}();n.TextHandler=a;var d=function(){var e=this;this.init=function(n){e.initialValue=getComputedStyle(n).display},this.update=function(n,t){n.style.display=t?e.initialValue:"none"}};n.VisibleHandler=d;var s=function(){function e(){}return e.prototype.init=function(e,n,t,i){e.addEventListener("input",(function(){var n=r.bindingEngine.getTransformFor(e,"value");n&&n.write?i(n.write(e.value)):i(e.value)}))},e.prototype.update=function(e,n){var t=r.bindingEngine.getTransformFor(e,"value");t&&t.read?e.value=t.read(n):e.value=n},e}();n.ValueHandler=s;var l=function(){function e(){}return e.prototype.init=function(e,n,t){"function"==typeof n&&e.addEventListener(t.parameter,(function(e){n(t.vm,e)}))},e}();n.EventHandler=l;var u=function(){function e(){}return e.prototype.update=function(e,n,t){e.setAttribute(t.parameter,n)},e}();n.AttributeHandler=u;var p=function(){function e(){}return e.prototype.init=function(e,n,t,i){r.scopes.set(n,t.vm)},e}();n.ScopeHandler=p;var c=function(){function e(){}return e.prototype.init=function(e,n,t,r){},e}();n.TransformHandler=c;var f=function(){function e(){}return e.prototype.init=function(e,n,t,r){for(var i=document.createDocumentFragment();e.childNodes.length>0;)i.appendChild(e.childNodes[0]);t.template=i},e.prototype.update=function(e,n,t,i){if(e.innerText="",n&&t.template){var o=t.template.cloneNode(!0);r.bind(o,t.originalVm),e.appendChild(o)}},e}();n.IfHandler=f;var m=function(){function e(){}return e.prototype.init=function(e,n,t,r){for(var i=document.createDocumentFragment();e.childNodes.length>0;)i.appendChild(e.childNodes[0]);t.template=i},e.prototype.update=function(e,n,t,i){if(e.innerText="",null!=n&&t.template){var o=t.template.cloneNode(!0);r.bind(o,n),e.appendChild(o)}},e}();n.ContextHandler=m;var v=function(){function e(){}return e.prototype.update=function(e,n,t,i){if(e.innerText="",null!=n){var o=document.createElement("template"),a=r.bindingEngine.getTransformFor(e,"html");o.innerHTML=a?a(n):n,e.appendChild(o.content),setTimeout((function(){for(var n=0;n<e.childNodes.length;n++)r.bind(e.childNodes[n],t.vm)}),0)}},e}();n.HtmlHandler=v;var b=function(){function e(){}return e.prototype.init=function(e,n,t,r){for(var i=document.createDocumentFragment();e.childNodes.length>0;)i.appendChild(e.childNodes[0]);t.template=i},e.prototype.update=function(e,n,t,o){if(o&&"splice"===o.type){for(var a=0,d=o.added;a<d.length;a++){b(u=d[a],o.index)}for(var s=0,l=o.removed;s<l.length;s++)for(var u=l[s],p=e.childNodes.length-1;p>=0;p--){if(r.contexts.has(e.childNodes[p])&&r.contexts.get(e.childNodes[p]).has("template"))u===r.contexts.get(e.childNodes[p]).get("template").vm&&e.childNodes[p].remove()}}else if(o&&"update"===o.type){e.innerHTML="";for(var c=0,f=o.newValue;c<f.length;c++){b(u=f[c])}}else for(var m=0,v=n;m<v.length;m++){b(u=v[m])}function b(n,o){if(t.template){var a=t.template.cloneNode(!0);r.bind(a,n);for(var d=function(t){var o=a.childNodes[t];1===o.nodeType&&setTimeout((function(){if("selecteditem"in e&&"selected"in o){var t={selected:i.observable.box(!1)},a=!1;i.observe(t.selected,(function(t){!0!==t.newValue||a||(a=!0,e.selecteditem=n),a=!1})),e.selecteditem===n&&setTimeout((function(){o.selected=!0}),10),i.observe(e,"selecteditem",(function(e){a||(a=!0,e.newValue===n?o.selected=!0:o.selected=!1),a=!1}));var d={handler:"__property",propertyName:"selected",bindingValue:t.selected,scope:t,vm:t,parameter:"selected",element:o};r.bindingEngine.bindInitPhase(d),r.bindingEngine.bindUpdatePhase(d)}}),0)},s=0;s<a.childNodes.length;s++)d(s);void 0!==o?e.insertBefore(a,e.children[o]):e.appendChild(a)}}},e}();n.ForEachHandler=b},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PropertyHandler=void 0;var r=t(0),i=t(2),o=function(){function e(){}return e.prototype.init=function(e,n,t,o){setTimeout((function(){var n=t.parameter,a=function e(n,t){if(n.hasOwnProperty(t))return{descriptor:Object.getOwnPropertyDescriptor(n,t),caseSensitiveName:t};for(var r in Object.getOwnPropertyDescriptors(n))if(r.toLowerCase()===t)return{descriptor:Object.getOwnPropertyDescriptors(n)[r],caseSensitiveName:r};var i=Object.getPrototypeOf(n);return i?e(i,t):null}(e,n);if(a){var d;t.parameter=a.caseSensitiveName;a.descriptor.set&&i.PROPERTY_SETTER_SYMBOL in a.descriptor.set?(d=a.descriptor.set[i.PROPERTY_SETTER_SYMBOL],!0):d=a.descriptor.set,Object.defineProperty(e,a.caseSensitiveName,{enumerable:a.descriptor.enumerable||!1,configurable:!0,get:a.descriptor.get,set:function(n){d&&d.call(e,n),t.preventCircularUpdate||o(n),t.preventCircularUpdate=!1}}),Object.getOwnPropertyDescriptor(e,a.caseSensitiveName).set[i.PROPERTY_SETTER_SYMBOL]=d}else{var s=r.observable.box(),l={};Object.defineProperty(l,n,{enumerable:!0,configurable:!0,get:function(){return s.get()},set:function(e){s.set(e),t.preventCircularUpdate||(t.preventCircularUpdate=!0,o(e)),t.preventCircularUpdate=!1}}),r.extendObservable(e,l)}}),0)},e.prototype.update=function(e,n,t,r){setTimeout((function(){t.preventCircularUpdate=!0,e[t.parameter]=n}),0)},e}();n.PropertyHandler=o}])}));